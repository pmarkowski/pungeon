(this["webpackJsonppungeon-react"]=this["webpackJsonppungeon-react"]||[]).push([[0],{30:function(e,t,n){},45:function(e,t,n){"use strict";n.r(t);var o,i,r=n(0),a=n(2),c=n.n(a),s=n(14),l=n.n(s),d=(n(30),n(3)),u=n(4),O=n(8),E=n(7),b=n(5),j={PNG_EXPORTED:"PNG_EXPORTED",EXPORT_TO_PNG_CLICKED:"EXPORT_TO_PNG_CLICKED",CLEAR_ONGOING_SPACE_POLYGON:"CLEAR_ONGOING_SPACE_POLYGON",ADD_ONGOING_SPACE_POLYGON:"ADD_ONGOING_SPACE_POLYGON",MOVE_VIEWPORT:"MOVE_VIEWPORT",SET_CURRENT_MOUSE_POSITION:"SET_CURRENT_MOUSE_POSITION",SCROLL_EVENT:"SCROLL_EVENT",MOUSE_DOWN:"MOUSE_DOWN",MOUSE_UP:"MOUSE_UP",SET_SCROLL_MOVES_VIEWPORT:"SET_SCROLL_MOVES_VIEWPORT",SELECT_TOOL:"SELECT_TOOL",SELECT_OBJECT:"SELECT_OBJECT",DELETE_OBJECT:"DELETE_OBJECT"},h=function(e,t){return{type:j.SET_CURRENT_MOUSE_POSITION,x:e,y:t}},y=n(10),x=n(16),f=n(1),T=function(e,t,n){return e.map((function(e){if(e.id===t){var o=Object(f.a)({},e);return n(o),o}return e}))},p={NEW_DUNGEON:"NEW_DUNGEON",SET_DUNGEON_SIZE:"SET_DUNGEON_SIZE",MOVE_SELECTED_OBJECT:"MOVE_SELECTED_OBJECT",SET_SELECTED_OBJECT_TEXTURE_PATH:"SET_SELECTED_OBJECT_TEXTURE_PATH",SET_SELECTED_OBJECT_ANGLE:"SET_SELECTED_OBJECT_ANGLE",SET_SELECTED_OBJECT_LABEL:"SET_SELECTED_OBJECT_LABEL",SET_SELECTED_OBJECT_POSITION:"SET_SELECTED_OBJECT_POSITION",SET_SELECTED_OBJECT_SIZE:"SET_SELECTED_OBJECT_SIZE",SET_SELECTED_OBJECT_START:"SET_SELECTED_OBJECT_START",SET_SELECTED_OBJECT_END:"SET_SELECTED_OBJECT_END",ADD_OBJECT:"ADD_OBJECT",DELETE_OBJECT:"DELETE_OBJECT"},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case p.NEW_DUNGEON:return{size:{width:24,height:32},objects:[]};case p.SET_DUNGEON_SIZE:return Object(f.a)(Object(f.a)({},e),{},{size:{width:t.width,height:t.height}});case p.MOVE_SELECTED_OBJECT:var n=T(e.objects,t.selectedObject,(function(e){return e.position={x:e.position.x+t.deltaX,y:e.position.y+t.deltaY}}));return Object(f.a)(Object(f.a)({},e),{},{objects:n});case p.SET_SELECTED_OBJECT_TEXTURE_PATH:var o=T(e.objects,t.selectedObject,(function(e){return e.textureUrl=t.texturePath}));return Object(f.a)(Object(f.a)({},e),{},{objects:o});case p.SET_SELECTED_OBJECT_ANGLE:var i=T(e.objects,t.selectedObject,(function(e){return e.angle=t.angle}));return Object(f.a)(Object(f.a)({},e),{},{objects:i});case p.SET_SELECTED_OBJECT_LABEL:var r=T(e.objects,t.selectedObject,(function(e){return e.label=t.label}));return Object(f.a)(Object(f.a)({},e),{},{objects:r});case p.SET_SELECTED_OBJECT_POSITION:var a=T(e.objects,t.selectedObject,(function(e){return e.position={x:t.x,y:t.y}}));return Object(f.a)(Object(f.a)({},e),{},{objects:a});case p.SET_SELECTED_OBJECT_SIZE:var c=T(e.objects,t.selectedObject,(function(e){return e.size={width:t.width,height:t.height}}));return Object(f.a)(Object(f.a)({},e),{},{objects:c});case p.SET_SELECTED_OBJECT_START:var s=T(e.objects,t.selectedObject,(function(e){return e.start={x:t.x,y:t.y}}));return Object(f.a)(Object(f.a)({},e),{},{objects:s});case p.SET_SELECTED_OBJECT_END:var l=T(e.objects,t.selectedObject,(function(e){return e.end={x:t.x,y:t.y}}));return Object(f.a)(Object(f.a)({},e),{},{objects:l});case p.ADD_OBJECT:var d=e.objects.slice();return d=[].concat(Object(x.a)(d),[t.newObject]),Object(f.a)(Object(f.a)({},e),{},{objects:d});case p.DELETE_OBJECT:var u=t.selectedObject;if(u){var O=e.objects.filter((function(e){return e.id!==u}));return Object(f.a)(Object(f.a)({},e),{},{objects:O})}return e;default:return e}},g={SELECT:"select",NEW_WALL:"new_wall",NEW_SPACE_RECTANGLE:"new_space_rectangle",NEW_SPACE_POLYGON:"new_space_polygon",NEW_DOOR:"new_door",NEW_LABEL:"new_label",NEW_TOKEN:"new_token"},v={scrollMovesViewport:!1,selectedTool:g.NEW_SPACE_RECTANGLE,scale:100,position:{x:0,y:0},mouse:{mouseDown:!1,startPosition:{x:0,y:0},currentPosition:{x:0,y:0}}},S=Object(y.b)({editor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j.PNG_EXPORTED:return Object(f.a)(Object(f.a)({},e),{},{exportToPngClicked:null});case j.EXPORT_TO_PNG_CLICKED:return Object(f.a)(Object(f.a)({},e),{},{exportToPngClicked:!0});case j.CLEAR_ONGOING_SPACE_POLYGON:return Object(f.a)(Object(f.a)({},e),{},{ongoingSpacePolygon:null});case j.ADD_ONGOING_SPACE_POLYGON:var n,o=[].concat(Object(x.a)(null!==(n=e.ongoingSpacePolygon)&&void 0!==n?n:[]),[t.position]);return Object(f.a)(Object(f.a)({},e),{},{ongoingSpacePolygon:o});case j.MOVE_VIEWPORT:return Object(f.a)(Object(f.a)({},e),{},{position:{x:e.position.x+t.deltaX,y:e.position.y+t.deltaY}});case j.SET_CURRENT_MOUSE_POSITION:return Object(f.a)(Object(f.a)({},e),{},{mouse:Object(f.a)(Object(f.a)({},e.mouse),{},{currentPosition:{x:t.x,y:t.y}})});case j.SCROLL_EVENT:if(!e.scrollMovesViewport||t.holdingCtrl){var i=10;t.scrollY>0&&(i*=-1);var r=10,a=200,c=Math.min(Math.max(e.scale+i,r),a);return e.scale!==c?Object(f.a)(Object(f.a)({},e),{},{scale:c,position:{x:e.position.x-e.mouse.currentPosition.x*(i/100),y:e.position.y-e.mouse.currentPosition.y*(i/100)}}):e}var s=.5;return Object(f.a)(Object(f.a)({},e),{},{position:{x:e.position.x-t.scrollX*s,y:e.position.y-t.scrollY*s}});case j.MOUSE_DOWN:return Object(f.a)(Object(f.a)({},e),{},{mouse:Object(f.a)(Object(f.a)({},e.mouse),{},{mouseDown:!0,startPosition:{x:e.mouse.currentPosition.x,y:e.mouse.currentPosition.y}})});case j.MOUSE_UP:return Object(f.a)(Object(f.a)({},e),{},{mouse:Object(f.a)(Object(f.a)({},e.mouse),{},{mouseDown:!1})});case j.SET_SCROLL_MOVES_VIEWPORT:return Object(f.a)(Object(f.a)({},e),{},{scrollMovesViewport:t.scrollMovesViewport});case j.SELECT_TOOL:var l=e.selectedObject;return t.selectedTool!==g.SELECT&&(l=null),Object(f.a)(Object(f.a)({},e),{},{selectedTool:t.selectedTool,selectedObject:l});case j.SELECT_OBJECT:return Object(f.a)(Object(f.a)({},e),{},{selectedObject:t.objectId});case j.DELETE_OBJECT:return Object(f.a)(Object(f.a)({},e),{},{selectedObject:null});default:return Object(f.a)({},e)}},dungeon:_}),C=Object(y.c)(S,{dungeon:{size:{width:28,height:32},objects:[{id:"423894382",type:"token",position:{x:2,y:4},size:{width:1,height:2},textureUrl:"/assets/stairs.png",angle:0},{id:"01f998f7-3ad4-43c6-b498-3249ab470b05",type:"space",position:{x:1,y:1},size:{width:5,height:5}},{id:"79178d8c-3a3e-42ee-b1ec-00dc37a045fc",type:"space",position:{x:6,y:4},size:{width:7,height:9}},{id:"6ce25fdc-9fd4-46c0-a924-74f5f9174193",type:"space",position:{x:15,y:15},size:{width:6,height:7}},{id:"e211fbd3-a817-47a5-bb47-481ba330e46d",type:"space",position:{x:21,y:19},size:{width:4,height:9}},{id:"4abe3330-4a95-4c29-b71d-8ea768da1ee6",type:"wall",start:{x:1,y:1},end:{x:1,y:6}},{id:"ad3c6f9b-f3f0-4025-8073-daacc68483ec",type:"wall",start:{x:6,y:6},end:{x:1,y:6}},{id:"68365136-d12f-4e54-8f7b-4cbd3ab424eb",type:"wall",start:{x:6,y:13},end:{x:6,y:6}},{id:"3d6435e5-8d67-4405-87d0-72c4e8f4dfaa",type:"wall",start:{x:13,y:13},end:{x:6,y:13}},{id:"384ac23d-f5fc-4cd1-9ad7-b528b62fa732",type:"wall",start:{x:13,y:4},end:{x:13,y:13}},{id:"161e3147-ca11-4dc4-a26b-ca8295c5abaa",type:"wall",start:{x:6,y:4},end:{x:13,y:4}},{id:"e8092d63-e7e2-4cd2-8c80-8cd6030980f1",type:"wall",start:{x:6,y:1},end:{x:6,y:4}},{id:"71ed94d3-177b-428b-a8e5-fe25eb79a4ea",type:"wall",start:{x:1,y:1},end:{x:6,y:1}},{id:"0ea47a6f-af9f-4ec6-a7f3-881332643e2a",type:"wall",start:{x:15,y:15},end:{x:15,y:22}},{id:"f7ec5579-7966-4ba4-b8ee-fdaad6372842",type:"wall",start:{x:21,y:22},end:{x:15,y:22}},{id:"1e587060-37cc-4b87-a88a-852c8055cabb",type:"wall",start:{x:21,y:15},end:{x:15,y:15}},{id:"79e1f702-6d60-435b-ba1e-584077a7d479",type:"wall",start:{x:21,y:19},end:{x:21,y:15}},{id:"231997d1-1453-4573-a2c0-0571428d7ac9",type:"wall",start:{x:25,y:19},end:{x:21,y:19}},{id:"85033454-8145-4d36-9b58-5e891f731f25",type:"wall",start:{x:21,y:22},end:{x:21,y:28}},{id:"2c6b4f88-4163-4847-ba05-c4ce865dfd87",type:"wall",start:{x:21,y:28},end:{x:25,y:28}},{id:"57013c9b-609f-4e59-ae1a-fd94a49bac80",type:"wall",start:{x:25,y:19},end:{x:25,y:28}}]}},"undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),m=70,N=n(6),w=n(47),L={SPACE:"space",WALL:"wall",DOOR:"door",LABEL:"label",TOKEN:"token"},P=function(e){return{type:p.DELETE_OBJECT,selectedObject:e}},D=function(e,t,n){return{type:p.MOVE_SELECTED_OBJECT,selectedObject:e,deltaX:t,deltaY:n}},A=function(e,t){return{type:p.SET_SELECTED_OBJECT_ANGLE,selectedObject:e,angle:t}},M=function(e){return e*e},I=function(e,t){return Math.sqrt(M(e.x-t.x)+M(e.y-t.y))},k=function(e,t,n){var o=n.x-t.x,i=n.y-t.y,r=o*o+i*i,a=(e.x-t.x)*o+(e.y-t.y)*i,c=Math.min(1,Math.max(0,a/r));return{x:t.x+o*c,y:t.y+i*c}},R=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,[{key:"onMouseUp",value:function(e){var t=e.getState(),n=t.editor.mouse.currentPosition,o=25,i=null,r=null;t.dungeon.objects.filter((function(e){return e.type===L.WALL})).forEach((function(e){var n={x:e.start.x*m,y:e.start.y*m},a={x:e.end.x*m,y:e.end.y*m},c=k({x:t.editor.mouse.startPosition.x,y:t.editor.mouse.startPosition.y},n,a),s=I(c,{x:t.editor.mouse.startPosition.x,y:t.editor.mouse.startPosition.y});(!o||s<o)&&(o=s,i=c,r=e.id)}));var a=t.dungeon.objects.find((function(e){return e.id===r}));if(a){var c,s,l,d,u={x:a.start.x*m,y:a.start.y*m},O={x:a.end.x*m,y:a.end.y*m},E=k(n,u,O);e.dispatch((c=i.x/m,s=i.y/m,l=E.x/m,d=E.y/m,{type:p.ADD_OBJECT,newObject:{id:Object(w.a)(),type:L.DOOR,start:{x:c,y:s},end:{x:l,y:d}}}))}}},{key:"renderTool",value:function(e,t){var n=e.editor.mouse.currentPosition;if(e.editor.mouse.mouseDown){var o=25,i=null,r=null;if(e.dungeon.objects.filter((function(e){return e.type===L.WALL})).forEach((function(t){var n={x:t.start.x*m,y:t.start.y*m},a={x:t.end.x*m,y:t.end.y*m},c=k({x:e.editor.mouse.startPosition.x,y:e.editor.mouse.startPosition.y},n,a),s=I(c,{x:e.editor.mouse.startPosition.x,y:e.editor.mouse.startPosition.y});(!o||s<o)&&(o=s,i=c,r=t.id)})),!i)return;var a=i.x,c=i.y,s=e.dungeon.objects.find((function(e){return e.id===r})),l={x:s.start.x*m,y:s.start.y*m},d={x:s.end.x*m,y:s.end.y*m},u=k(n,l,d),O=u.x,E=u.y;t.lineStyle(5,16776448),t.moveTo(a,c),t.lineTo(O,E),t.lineStyle(),t.beginFill(16776448),t.drawCircle(a,c,2.5),t.drawCircle(O,E,2.5),t.endFill()}else{var b=25,j=null;e.dungeon.objects.filter((function(e){return e.type===L.WALL})).forEach((function(e){var t={x:e.start.x*m,y:e.start.y*m},o={x:e.end.x*m,y:e.end.y*m},i=k(n,t,o),r=I(i,n);(!b||r<b)&&(b=r,j=i)})),j&&(t.lineStyle(),t.beginFill(16776448),t.drawCircle(j.x,j.y,2.5),t.endFill())}}}]),e}(),B=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,[{key:"onMouseUp",value:function(e){var t,n,o,i=e.getState().editor.mouse.currentPosition,r=i.x/m,a=i.y/m;e.dispatch((t=r,n=a,o="Text Label",{type:p.ADD_OBJECT,newObject:{id:Object(w.a)(),type:L.LABEL,position:{x:t,y:n},label:o}}))}},{key:"renderTool",value:function(e,t){}}]),e}(),U=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,[{key:"onMouseUp",value:function(e){var t=e.getState(),n=t.editor.mouse.currentPosition,o=Math.floor(Math.min(t.editor.mouse.startPosition.x,n.x)/m),i=Math.floor(Math.min(t.editor.mouse.startPosition.y,n.y)/m),r=Math.ceil(Math.max(t.editor.mouse.startPosition.x,n.x)/m),a=Math.ceil(Math.max(t.editor.mouse.startPosition.y,n.y)/m);e.dispatch(function(e,t,n,o){return{type:p.ADD_OBJECT,newObject:{id:Object(w.a)(),type:L.SPACE,position:{x:e,y:t},size:{width:n-e,height:o-t}}}}(o,i,r,a))}},{key:"renderTool",value:function(e,t){var n,o,i,r,a=e.editor.mouse.currentPosition;if(e.editor.mouse.mouseDown){var c=Math.min(e.editor.mouse.startPosition.x,a.x),s=Math.min(e.editor.mouse.startPosition.y,a.y),l=Math.max(e.editor.mouse.startPosition.x,a.x),d=Math.max(e.editor.mouse.startPosition.y,a.y);n=Math.floor(c/m)*m,o=Math.floor(s/m)*m,i=(l=Math.floor(l/m)*m+m)-n,r=(d=Math.floor(d/m)*m+m)-o}else n=Math.floor(a.x/m)*m,o=Math.floor(a.y/m)*m,i=m,r=m;t.beginFill(0,0),t.lineStyle(1,16776448),t.drawRect(n,o,i,r),t.endFill()}}]),e}(),J=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,[{key:"onMouseUp",value:function(e){var t=e.getState(),n=t.editor.mouse.currentPosition,o=Math.round(t.editor.mouse.startPosition.x/m),i=Math.round(t.editor.mouse.startPosition.y/m),r=Math.round(n.x/m),a=Math.round(n.y/m);e.dispatch(function(e,t,n,o){return{type:p.ADD_OBJECT,newObject:{id:Object(w.a)(),type:L.WALL,start:{x:e,y:t},end:{x:n,y:o}}}}(o,i,r,a))}},{key:"renderTool",value:function(e,t){var n=e.editor.mouse.currentPosition;if(e.editor.mouse.mouseDown){var o=Math.round(e.editor.mouse.startPosition.x/m)*m,i=Math.round(e.editor.mouse.startPosition.y/m)*m,r=Math.round(n.x/m)*m,a=Math.round(n.y/m)*m;t.lineStyle(5,16776448),t.moveTo(o,i),t.lineTo(r,a),t.lineStyle(),t.beginFill(16776448),t.drawCircle(o,i,2.5),t.drawCircle(r,a,2.5),t.endFill()}else{var c=Math.round(n.x/m)*m,s=Math.round(n.y/m)*m;t.lineStyle(),t.beginFill(16776448),t.drawCircle(c,s,2.5),t.endFill()}}}]),e}(),G=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,[{key:"onMouseUp",value:function(e,t){}},{key:"renderTool",value:function(e,t){}}]),e}(),W=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,[{key:"onMouseUp",value:function(e){var t,n,o=e.getState(),i=o.editor.mouse.currentPosition,r=Math.round(i.x/m),a=Math.round(i.y/m),c=null===(t=o.editor.ongoingSpacePolygon)||void 0===t?void 0:t[0];if(c&&c.x===r&&c.y===a){var s=o.editor.ongoingSpacePolygon;e.dispatch({type:j.CLEAR_ONGOING_SPACE_POLYGON}),e.dispatch((n=s,{type:p.ADD_OBJECT,newObject:{id:Object(w.a)(),type:L.SPACE,points:n}}))}else e.dispatch(function(e,t){return{type:j.ADD_ONGOING_SPACE_POLYGON,position:{x:e,y:t}}}(r,a))}},{key:"renderTool",value:function(e,t){var n=e.editor.mouse.currentPosition,o=Math.round(n.x/m)*m,i=Math.round(n.y/m)*m;if(e.editor.ongoingSpacePolygon){t.lineStyle(2,16776448);var r=e.editor.ongoingSpacePolygon[0];t.moveTo(r.x*m,r.y*m);for(var a=1;a<e.editor.ongoingSpacePolygon.length;a++){var c=e.editor.ongoingSpacePolygon[a];t.lineTo(c.x*m,c.y*m)}t.lineTo(o,i),t.lineStyle()}else t.lineStyle(),t.beginFill(16776448),t.drawCircle(o,i,2.5),t.endFill()}}]),e}(),z=function(){function e(){Object(d.a)(this,e),this.tokenTextureUrl="/assets/stairs.png",this.height=2,this.width=1}return Object(u.a)(e,[{key:"onMouseUp",value:function(e){var t,n,o,i,r,a,c,s,l=e.getState().editor.mouse.currentPosition;t=Math.floor(l.x/m),n=Math.floor(l.y/m),e.dispatch((o=this.tokenTextureUrl,i=t,r=n,a=this.width,c=this.height,s=0,{type:p.ADD_OBJECT,newObject:{id:Object(w.a)(),type:L.TOKEN,textureUrl:o,position:{x:i,y:r},size:{width:a,height:c},angle:s}}))}},{key:"renderTool",value:function(e,t){var n,o,i=e.editor.mouse.currentPosition;n=Math.floor(i.x/m)*m,o=Math.floor(i.y/m)*m,t.beginFill(0,0),t.lineStyle(1,16776448),t.drawRect(n,o,this.width*m,this.height*m),t.endFill()}}]),e}(),V=(o={},Object(N.a)(o,g.NEW_DOOR,new R),Object(N.a)(o,g.NEW_SPACE_RECTANGLE,new U),Object(N.a)(o,g.NEW_SPACE_POLYGON,new W),Object(N.a)(o,g.NEW_WALL,new J),Object(N.a)(o,g.SELECT,new G),Object(N.a)(o,g.NEW_LABEL,new B),Object(N.a)(o,g.NEW_TOKEN,new z),o),F=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,[{key:"createRenderObject",value:function(){return new b.c}}]),e}(),X=function(e){Object(O.a)(n,e);var t=Object(E.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"renderObject",value:function(e,t,n){e.zIndex=3,e.clear(),e.beginFill(11094,1),e.lineStyle(20,11094,1,.5),e.moveTo(t.start.x*m,t.start.y*m),e.lineTo(t.end.x*m,t.end.y*m),e.lineStyle();var o=10;e.endFill(),e.tint=n?16777011:16777215,e.hitArea=new b.d([t.start.x*m-o,t.start.y*m-o,t.start.x*m+o,t.start.y*m+o,t.end.x*m+o,t.end.y*m+o,t.end.x*m-o,t.end.y*m-o])}}]),n}(F),Y=function(e){Object(O.a)(n,e);var t=Object(E.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"renderObject",value:function(e,t,n){if(e.zIndex=4,e.clear(),0===e.children.length){var o=new b.g(t.label);o.style.fontFamily="Serif",o.style.fontSize=36,e.addChild(o)}var i=e.children[0];i.style.fill=n?16777011:0,i.text=t.label,i.position.set(t.position.x*m,t.position.y*m)}}]),n}(F),K=function(e){Object(O.a)(n,e);var t=Object(E.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"renderObject",value:function(e,t,n){e.zIndex=2,e.clear(),e.beginFill(157414,1),e.lineStyle(10,157414,1,.5),e.moveTo(t.start.x*m,t.start.y*m),e.lineTo(t.end.x*m,t.end.y*m),e.lineStyle(),e.drawCircle(t.start.x*m,t.start.y*m,5),e.drawCircle(t.end.x*m,t.end.y*m,5);e.endFill(),e.tint=n?16777011:16777215,e.hitArea=this.createWallHitArea(t,5)}},{key:"createWallHitArea",value:function(e,t){if(e.start.x===e.end.x&&e.start.y===e.end.y)return new b.b(e.start.x*m,e.start.y*m,t);var n=e.start.x<=e.end.x?e.start:e.end,o=e.start.x>e.end.x?e.start:e.end,i=o.y-n.y,r=o.x-n.x,a=i/r,c=-1/a;if(0===a||0===c)return new b.e(n.x*m-t,Math.min(n.y,o.y)*m-t,r*m+2*t,Math.abs(i)*m+2*t);var s=this.getOffsetAlongSlope(a,t),l=s.xOffset,d=s.yOffset,u=this.getOffsetAlongSlope(c,t),O=u.xOffset,E=u.yOffset;return new b.d([n.x*m-l-O,n.y*m-d-E,n.x*m-l+O,n.y*m-d+E,o.x*m+l+O,o.y*m+d+E,o.x*m+l-O,o.y*m+d-E])}},{key:"getOffsetAlongSlope",value:function(e,t){var n=Math.atan(e);return{xOffset:Math.cos(n)*t,yOffset:Math.sin(n)*t}}}]),n}(F),Z=function(e){Object(O.a)(n,e);var t=Object(E.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"renderObject",value:function(e,t,n){if(e.clear(),e.beginFill(14079445),t.position&&t.size)e.drawRect(t.position.x*m,t.position.y*m,t.size.width*m,t.size.height*m),e.endFill();else{var o=t.points[0];e.moveTo(o.x*m,o.y*m);for(var i=0;i<t.points.length;i++){var r=t.points[i];e.lineTo(r.x*m,r.y*m)}e.endFill()}e.tint=n?16777164:16777215}}]),n}(F),H=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,[{key:"createRenderObject",value:function(){return new b.f}},{key:"renderObject",value:function(e,t,n){var o;(e.zIndex=4,e.texture=b.h.from("/pungeon-react"+t.textureUrl),e.x=t.position.x*m,e.y=t.position.y*m,e.width=t.size.width*m,e.height=t.size.height*m,e.angle=t.angle,n)?(0===e.children.length?(o=new b.c,e.addChild(o)):o=e.getChildAt(0),o.clear(),o.lineStyle(5,16776448),o.drawShape(e.getLocalBounds())):e.children.length>0&&e.removeChildAt(0)}}]),e}(),q=(i={},Object(N.a)(i,L.DOOR,new X),Object(N.a)(i,L.LABEL,new Y),Object(N.a)(i,L.WALL,new K),Object(N.a)(i,L.SPACE,new Z),Object(N.a)(i,L.TOKEN,new H),i),$=function(e,t){var n=document.createElement("a");n.href=e,n.download=t,n.target="_blank",n.click()},Q=function(e,t){var n=C.getState();e.stage.position.set(n.editor.position.x,n.editor.position.y);var o=n.editor.scale/100;if(e.stage.scale.x!==o&&e.stage.scale.set(o),t.clear(),ee(e.stage,n),te(t,n.dungeon.size.width,n.dungeon.size.height),n.editor.exportToPngClicked&&function(e){var t=e.renderer.generateTexture(e.stage,null,1/e.stage.scale.x,new b.e(e.stage.position.x-1,e.stage.position.y-1,e.stage.width,e.stage.height));$(e.renderer.extract.base64(t),"dungeon.png"),C.dispatch({type:j.PNG_EXPORTED})}(e),e.renderer.plugins.interaction.mouseOverRenderer){!function(e,t){V[e.editor.selectedTool].renderTool(e,t)}(n,t);var i=e.renderer.plugins.interaction.mouse.getLocalPosition(e.stage);C.dispatch(h(i.x,i.y))}else C.dispatch(h(null,null))},ee=function(e,t){var n=t.dungeon.objects.reduce((function(e,t){return e[t.id]=t,e}),{}),o=new Set(e.children.map((function(e){return e.id})));Object.keys(n).forEach((function(t){if(!o.has(t)){var i=(r=n[t],q[r.type].createRenderObject());i.id=t,i.interactive=!0,i.mouseup=function(){C.getState().editor.selectedTool===g.SELECT&&C.dispatch(function(e){return{type:j.SELECT_OBJECT,objectId:e}}(this.id))},e.addChild(i)}var r})),e.children.forEach((function(o){if(o.id){var i=n[o.id];i?function(e,t,n){q[t.type].renderObject(e,t,n)}(o,i,t.editor.selectedObject===o.id):e.removeChild(o)}}))},te=function(e,t,n){e.lineStyle(1,4473924,1,.5);for(var o=0;o<=t;o++)e.moveTo(o*m,0),e.lineTo(o*m,n*m);for(var i=0;i<=n;i++)e.moveTo(0,i*m),e.lineTo(t*m,i*m)};var ne=function(e,t){var n=t.getState();switch(e.key){case"Delete":return t.dispatch(P(n.editor.selectedObject));case"ArrowLeft":return t.dispatch(D(n.editor.selectedObject,-1,0));case"ArrowRight":return t.dispatch(D(n.editor.selectedObject,1,0));case"ArrowDown":return t.dispatch(D(n.editor.selectedObject,0,1));case"ArrowUp":return t.dispatch(D(n.editor.selectedObject,0,-1));default:return}},oe=function(e,t){1===e.buttons&&t.dispatch({type:j.MOUSE_DOWN})},ie=function(e,t){t.getState().editor.mouse.mouseDown&&(t.dispatch({type:j.MOUSE_UP}),function(e){var t=e.getState();V[t.editor.selectedTool].onMouseUp(e)}(t))},re=function(e,t){var n,o;2===e.buttons&&t.dispatch((n=e.movementX,o=e.movementY,{type:j.MOVE_VIEWPORT,deltaX:n,deltaY:o}))},ae=function(e,t){var n,o,i;t.dispatch((n=e.deltaX,o=e.deltaY,i=e.getModifierState("Control"),{type:j.SCROLL_EVENT,scrollX:n,scrollY:o,holdingCtrl:i}))},ce=function(e){Object(O.a)(n,e);var t=Object(E.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){var e=this;return Object(r.jsx)("div",{style:{height:"85vh"},tabIndex:-1,ref:function(t){return e.canvasDiv=t}})}},{key:"componentDidMount",value:function(){var e=new b.a({backgroundColor:6250335,sharedLoader:!0,sharedTicker:!0,antialias:!0});this.app=e,this.canvasDiv.appendChild(e.view),this.app.resizeTo=this.canvasDiv,this.app.resize();var t=new b.c;t.zIndex=Number.MAX_SAFE_INTEGER,e.stage.sortableChildren=!0,e.stage.addChild(t),this.setupInteractions(),e.ticker.add((function(){Q(e,t)}))}},{key:"setupInteractions",value:function(){this.canvasDiv.addEventListener("wheel",(function(e){ae(e,C),e.preventDefault()})),this.canvasDiv.addEventListener("contextmenu",(function(e){e.preventDefault()})),this.canvasDiv.addEventListener("pointerdown",(function(e){oe(e,C)})),this.canvasDiv.addEventListener("pointerup",(function(e){ie(0,C)})),this.canvasDiv.addEventListener("pointermove",(function(e){re(e,C)})),this.canvasDiv.addEventListener("keydown",(function(e){ne(e,C)}))}}]),n}(c.a.Component),se=n(11),le=function(e){var t=e.title,n=e.children;return Object(r.jsxs)("div",{className:"card bg-dark text-light border-secondary mb-3",children:[Object(r.jsx)("div",{className:"card-header border-secondary",children:Object(r.jsx)("h5",{children:t})}),Object(r.jsx)("div",{className:"card-body",children:Object(r.jsx)("div",{className:"form-group",children:n})})]})},de=function(e){var t=e.title,n=e.x,o=e.y,i=e.onUpdate;return Object(r.jsxs)(le,{title:null!==t&&void 0!==t?t:"Position",children:[Object(r.jsxs)("label",{children:["X:",Object(r.jsx)("input",{className:"form-control bg-secondary text-light",type:"number",value:n,onChange:function(e){return i(parseInt(e.target.value),o)}})]}),Object(r.jsxs)("label",{children:["Y:",Object(r.jsx)("input",{className:"form-control bg-secondary text-light",type:"number",value:o,onChange:function(e){return i(n,parseInt(e.target.value))}})]})]})},ue=function(e){var t=e.title,n=e.width,o=e.height,i=e.onUpdate;return Object(r.jsxs)(le,{title:null!==t&&void 0!==t?t:"Size",children:[Object(r.jsxs)("label",{children:["Width:",Object(r.jsx)("input",{className:"form-control bg-secondary text-light",type:"number",value:n,onChange:function(e){return i(parseInt(e.target.value),o)}})]}),Object(r.jsxs)("label",{children:["Height:",Object(r.jsx)("input",{className:"form-control bg-secondary text-light",type:"number",value:o,onChange:function(e){return i(n,parseInt(e.target.value))}})]})]})},Oe=function(e){var t=e.dispatch,n=e.selectedObjectId,o=e.selectedObject,i=e.dungeonSize,a=e.scrollPansViewport;return n?Object(r.jsxs)(c.a.Fragment,{children:[void 0!==o.label&&Object(r.jsx)(le,{title:"Label",children:Object(r.jsxs)("label",{children:["Label:",Object(r.jsx)("input",{className:"form-control bg-secondary text-light",type:"text",value:o.label,onChange:function(e){return t(function(e,t){return{type:p.SET_SELECTED_OBJECT_LABEL,selectedObject:e,label:t}}(n,e.target.value))}})]})}),void 0!==o.textureUrl&&Object(r.jsx)(le,{title:"Texture Path",children:Object(r.jsxs)("label",{children:["Path:",Object(r.jsx)("input",{className:"form-control bg-secondary text-light",value:o.textureUrl,onChange:function(e){t(function(e,t){return{type:p.SET_SELECTED_OBJECT_TEXTURE_PATH,selectedObject:e,texturePath:t}}(n,e.target.value))}})]})}),o.position&&Object(r.jsx)(de,{x:o.position.x,y:o.position.y,onUpdate:function(e,o){return t(function(e,t,n){return{type:p.SET_SELECTED_OBJECT_POSITION,selectedObject:e,x:t,y:n}}(n,e,o))}}),o.size&&Object(r.jsx)(ue,{width:o.size.width,height:o.size.height,onUpdate:function(e,o){return t(function(e,t,n){return{type:p.SET_SELECTED_OBJECT_SIZE,selectedObject:e,width:t,height:n}}(n,e,o))}}),o.start&&Object(r.jsx)(de,{title:"Start",x:o.start.x,y:o.start.y,onUpdate:function(e,o){return t(function(e,t,n){return{type:p.SET_SELECTED_OBJECT_START,selectedObject:e,x:t,y:n}}(n,e,o))}}),o.end&&Object(r.jsx)(de,{title:"End",x:o.end.x,y:o.end.y,onUpdate:function(e,o){return t(function(e,t,n){return{type:p.SET_SELECTED_OBJECT_END,selectedObject:e,x:t,y:n}}(n,e,o))}}),void 0!==o.angle&&Object(r.jsx)(le,{title:"Angle",children:Object(r.jsxs)("label",{children:["Angle:",Object(r.jsx)("input",{className:"form-control bg-secondary text-light",type:"number",step:"45",min:"-360",max:"360",value:o.angle,onChange:function(e){t(A(n,e.target.value))}}),Object(r.jsx)("input",{className:"form-control bg-secondary text-light",type:"range",step:"45",min:"-360",max:"360",style:{direction:"rtl"},value:o.angle,onChange:function(e){t(A(n,e.target.value))}})]})}),n&&Object(r.jsx)(le,{title:"Actions",children:Object(r.jsx)("button",{className:"btn btn-outline-danger",onClick:function(){return t(P(n))},children:"Delete Object"})})]}):Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsxs)(le,{title:"Instructions",children:[Object(r.jsxs)("p",{children:[Object(r.jsx)("i",{children:"Right click"})," to pan the view."]}),Object(r.jsxs)("p",{children:[Object(r.jsx)("i",{children:"Scroll"})," to zoom in and out."]}),Object(r.jsxs)("p",{children:[Object(r.jsx)("i",{children:"Left click and drag"})," to create new spaces with the New Space tool."]}),Object(r.jsxs)("p",{children:[Object(r.jsx)("i",{children:"Left click"})," to select spaces with the Select tool."]}),Object(r.jsxs)("p",{children:[Object(r.jsx)("i",{children:"Arrow keys"})," will move the currently selected space."]}),Object(r.jsxs)("p",{children:[Object(r.jsx)("i",{children:"Delete"})," will delete the currently selected space."]})]}),Object(r.jsxs)(le,{title:"Actions",children:[Object(r.jsx)("button",{className:"btn btn-primary form-control mb-2",onClick:function(){return t({type:j.EXPORT_TO_PNG_CLICKED})},children:"Download Dungeon as PNG"}),Object(r.jsx)("button",{className:"btn btn-outline-danger form-control mb-2",onClick:function(){return t({type:p.NEW_DUNGEON})},children:"New Dungeon"})]}),Object(r.jsx)(ue,{title:"Dungeon Size",width:i.width,height:i.height,onUpdate:function(e,n){return t(function(e,t){return{type:p.SET_DUNGEON_SIZE,width:e,height:t}}(e,n))}}),Object(r.jsx)(le,{title:"Editor Options",children:Object(r.jsxs)("label",{children:[Object(r.jsx)("input",{type:"checkbox",value:a,onChange:function(e){return t((n=e.target.checked,{type:j.SET_SCROLL_MOVES_VIEWPORT,scrollMovesViewport:n}));var n}}),"Scroll to pan"]})})]})},Ee=Oe=Object(se.b)((function(e){return{selectedObjectId:e.editor.selectedObject,selectedObject:e.dungeon.objects.find((function(t){return t.id===e.editor.selectedObject})),dungeonSize:e.dungeon.size,scrollMovesViewport:e.editor.scrollMovesViewport}}))(Oe),be=function(e){var t=e.toolName,n=e.toolId,o=e.selectedTool,i=e.onClick;return Object(r.jsx)("button",{className:"btn btn-secondary"+(o===n?" active":""),onClick:function(){return i(n)},children:t})},je=function(e){var t=e.dispatch,n=e.selectedTool,o=function(e){return t({type:j.SELECT_TOOL,selectedTool:e})};return Object(r.jsxs)("div",{className:"btn-group",role:"group",children:[Object(r.jsx)(be,{toolName:"Select",toolId:g.SELECT,selectedTool:n,onClick:o}),Object(r.jsx)(be,{toolName:"New Rectangular Space",toolId:g.NEW_SPACE_RECTANGLE,selectedTool:n,onClick:o}),Object(r.jsx)(be,{toolName:"New Polygonal Space",toolId:g.NEW_SPACE_POLYGON,selectedTool:n,onClick:o}),Object(r.jsx)(be,{toolName:"New Wall",toolId:g.NEW_WALL,selectedTool:n,onClick:o}),Object(r.jsx)(be,{toolName:"New Door",toolId:g.NEW_DOOR,selectedTool:n,onClick:o}),Object(r.jsx)(be,{toolName:"New Label",toolId:g.NEW_LABEL,selectedTool:n,onClick:o}),Object(r.jsx)(be,{toolName:"New Token",toolId:g.NEW_TOKEN,selectedTool:n,onClick:o})]})},he=je=Object(se.b)((function(e){return{selectedTool:e.editor.selectedTool}}))(je);var ye=function(){return Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)("nav",{className:"navbar navbar-dark bg-secondary",children:Object(r.jsx)("span",{className:"navbar-brand",children:"Pungeon"})}),Object(r.jsxs)("div",{className:"px-5",children:[Object(r.jsx)("div",{className:"py-2",children:Object(r.jsx)(he,{})}),Object(r.jsxs)("div",{className:"row",children:[Object(r.jsx)("div",{className:"col-md-9",children:Object(r.jsx)(ce,{})}),Object(r.jsx)("div",{className:"col-md-3",children:Object(r.jsx)(Ee,{})})]})]})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(se.a,{store:C,children:Object(r.jsx)(ye,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[45,1,2]]]);
//# sourceMappingURL=main.99e1e781.chunk.js.map